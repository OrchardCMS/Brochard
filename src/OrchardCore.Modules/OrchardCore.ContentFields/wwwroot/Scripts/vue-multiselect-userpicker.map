{"version":3,"sources":["<anon>"],"sourcesContent":["function debounceUserPicker(func, wait, immediate) {\r\n    var timeout;\r\n    return function () {\r\n        var context = this, args = arguments;\r\n        var later = function () {\r\n            timeout = null;\r\n            if (!immediate) func.apply(context, args);\r\n        };\r\n        var callNow = immediate && !timeout;\r\n        clearTimeout(timeout);\r\n        timeout = setTimeout(later, wait);\r\n        if (callNow) func.apply(context, args);\r\n    };\r\n};\r\nfunction initVueMultiselectUserPicker(element) {\r\n    // only run script if element exists\r\n    if (element) {\r\n        var elementId = element.id;\r\n        var selectedUsers = JSON.parse(element.dataset.selectedUsers || \"[]\");\r\n        var searchUrl = element.dataset.searchUrl;\r\n        var multiple = JSON.parse(element.dataset.multiple);\r\n\r\n        var debouncedSearch = debounceUserPicker(function (vm, query) {\r\n            vm.isLoading = true;\r\n            var searchFullUrl = searchUrl;\r\n            if (query) {\r\n                searchFullUrl += '&query=' + query;\r\n            }\r\n            fetch(searchFullUrl).then(function (res) {\r\n                res.json().then(function (json) {\r\n                    vm.options = json;\r\n                    vm.isLoading = false;\r\n                })\r\n            });\r\n        }, 250);\r\n\r\n        var vueMultiselect = Vue.component('vue-multiselect', window.VueMultiselect.default);\r\n\r\n        var vm = new Vue({\r\n            el: '#' + elementId,\r\n            components: { 'vue-multiselect': vueMultiselect },\r\n            data: {\r\n                value: null,\r\n                arrayOfUsers: selectedUsers,\r\n                options: [],\r\n            },\r\n            computed: {\r\n                selectedIds: function () {\r\n                    return this.arrayOfUsers.map(function (x) { return x.id }).join(',');\r\n                },\r\n                isDisabled: function () {\r\n                    return this.arrayOfUsers.length > 0 && !multiple;\r\n                }\r\n            },\r\n            watch: {\r\n                selectedIds: function () {\r\n                    // We add a delay to allow for the <input> to get the actual value\t\r\n                    // before the form is submitted\t\r\n                    setTimeout(function () { $(document).trigger('contentpreview:render') }, 100);\r\n                }\r\n            },\r\n            created: function () {\r\n                var self = this;\r\n                self.asyncFind();\r\n            },\r\n            mounted: function () {\r\n                // Store a reference to the div containing the search box used to select users\r\n                // so we can hide/show it later (in onSelect and remove). We use the \"mounted\"\r\n                // lifecycle method rather than \"created\" so we know the component has been attached \r\n                // to the DOM and we can therefore travese the DOM to find the desired div.\r\n                this.searchBoxContainer = $(this.$el).children().last();\r\n\r\n                // If we're loading an existing content item, we may already have a user picker\r\n                // configured to only allow a single user and that user has already been selected.\r\n                // In this case, we need to hide the search box now and not wait for onSelect or remove.\r\n                this.searchBoxContainer.css(\"display\", multiple || this.arrayOfUsers.length === 0 ? \"block\" : \"none\");\r\n            },\r\n            methods: {\r\n                asyncFind: function (query) {\r\n                    var self = this;\r\n                    debouncedSearch(self, query);\r\n                },\r\n                onSelect: function (selectedOption, id) {\r\n                    var self = this;\r\n\r\n                    for (i = 0; i < self.arrayOfUsers.length; i++) {\r\n                        if (self.arrayOfUsers[i].id === selectedOption.id) {\r\n                            return;\r\n                        }\r\n                    }\r\n\r\n                    self.arrayOfUsers.push(selectedOption);\r\n\r\n                    // We don't want to show the search box if we are only allowing a single user \r\n                    // and a user has already been selected. We don't need that search box again \r\n                    // unless and until we delete the currently selected user. So here we \r\n                    // set the display mode accordingly. We always show the select list if allowing \r\n                    // multiple users and do not show it if we're only allowing a single user \r\n                    // and we've just selected that one user.\r\n                    this.searchBoxContainer.css(\"display\", multiple ? \"block\" : \"none\");\r\n                },\r\n                remove: function (user) {\r\n                    this.arrayOfUsers.splice(this.arrayOfUsers.indexOf(user), 1);\r\n\r\n                    // After removing a selected user, we always want to show the search box \r\n                    // since (1) if we are allowing multiple users to be selected, we always \r\n                    // want to show it, and (2) if we are only allowing a single user to be \r\n                    // selected, and we've just removed that user, we now need to show the \r\n                    // search box so we are able to add a new one.\r\n                    this.searchBoxContainer.css(\"display\", \"block\");\r\n                }\r\n            }\r\n        })\r\n        \r\n        /*Hook for other scripts that might want to have access to the view model*/\r\n        var event = new CustomEvent(\"vue-multiselect-userpicker-created\", { detail: { vm: vm } });\r\n        document.querySelector(\"body\").dispatchEvent(event);\r\n    }\r\n}\r\n"],"names":["debounceUserPicker","func","wait","immediate","timeout","context","args","arguments","callNow","clearTimeout","setTimeout","apply","initVueMultiselectUserPicker","element","elementId","id","selectedUsers","JSON","parse","dataset","searchUrl","multiple","debouncedSearch","vm","query","isLoading","searchFullUrl","fetch","then","res","json","options","vueMultiselect","Vue","component","window","VueMultiselect","default","event","CustomEvent","detail","el","components","data","value","arrayOfUsers","computed","selectedIds","map","x","join","isDisabled","length","watch","$","document","trigger","created","self","asyncFind","mounted","searchBoxContainer","$el","children","last","css","methods","onSelect","selectedOption","i","push","remove","user","splice","indexOf","querySelector","dispatchEvent"],"mappings":"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"}